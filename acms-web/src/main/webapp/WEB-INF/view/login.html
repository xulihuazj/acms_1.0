<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no" />

<title>集团客户移动管理平台登录</title>
<link rel="shortcut icon" href="${base}/images/favicon.ico" />
<!-- Bootstrap core CSS -->
<link href="${base}/script/lib/ui-bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<link href="${base}/themes/login.css" rel="stylesheet" />

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="${base}/script/lib/html5shiv/html5shiv.min.js"></script>
  <script src="${base}/script/lib/respond/respond.min.js"></script>
<![endif]-->
    
<style type="text/css">
	body {
		font-family:   "Noto Sans","Microsoft Yahei",Arial,Helvetica,sans-serif;
		padding-top: 0px;
	}
	html, header, body{
    	min-width: 1300px !important ;
    }
	header{
		position: absolute;
		top: 0px;
		left: 0px;
		right: 0px;
		height: 60px;
		margin-bottom: 0px !important;
		background-color: #1e82c6 !important;
		padding-top: 10px;
		border-radius: 0 !important;
		border: none !important;
	}
    .container, .jumbotron{
    	min-width: 1200px !important;
    }
	.navbar-nav li:HOVER, .navbar-nav li.active{
		background: #0094e4;
	}
	
	.navbar-nav li:HOVER a,  .navbar-nav li.active a{
		color: #fff !important;
	}
	
	#username, #password, #pin{
		padding-left: 0px;
	}
	
	.mdc-layer{
		z-index: 999;
		position: relative;
	}
	.input-group-addon{
		border:1px solid #bdbdbd !important;
		height:40px !important;
		width:40px !important;
		padding: 0px !important;
	}
	input[class="form-control"]{
		width:266px !important;
		border-left:0px !important;
		border:1px solid #bdbdbd;
	}
	div[class="form-control"]{
		width:266px !important;
		border-left:0px !important;
		/* border-right:0px !important; */
	}
	.form-control{
		padding-top:10px !important;
		height:40px !important;
		padding-left:10px !important;
	}
	.loginTitle{
		color:#5e5e5e;
		font-size:16px;
	}
</style>
</head>
<body>
	<header class="navbar navbar-default">
		<div class="container">
			<div class="navbar-header" style="margin-left:120px;">
				<a id="header-logo-link" class="navbar-brand logo-link hidden-xs" href="javascript:void(0)">
					<img alt="${projectName!''}" src="${base}/images/logo-new.png" style="float: left;" />
					<span class="logoWord" style="line-height: 40px">${projectName!''}</span>
				</a>
			</div>
			<!--/.nav-collapse -->
		</div>
	</header>
	
	<div class="jumbotron oa-login-jumbotron ecss-login-jumbotron">
		<div class="oa-login-panel" ></div>
		<div class="cloudDiv">
			<div class="topTwoCloud">
				<div class="scroll-containerFirst scoll-first">
					<img src="${base}/themes/default/images/cloud1.png" border="0" />
				</div>
			</div>

			<div class="middleCloud">
				<div class="srcoll-containerSecond scoll-second">
					<img src="${base}/themes/default/images/cloud2.png" border="0" />
				</div>
			</div>

			<div class="lowCloud">
				<div class="srcoll-containerThird scoll-third">
					<img src="${base}/themes/default/images/cloud3.png" border="0" />
				</div>
			</div>
		</div>
	  	<div class="container">
			<div class="loginText">
				<img src="${base}/themes/default/images/text.png"/>
			</div>
	  		<div id="ecss-login-form" class="oa-login-form">
	  			<form id="frm" role="form" method="post" action="${loginUrl}" >
					<input type="hidden" name="cardId" id="cardId" />
					<!--<span class="loginTitle">登录集团客户移动管理平台</span>-->
					<div id="infoDiv" class="info" style="font-size: 14px;font-family: inherit;font-weight: 500;border: 1px solid #ffe57d;background-color:#fff6d2;width:306px;height:26px;line-height:26px;padding-left:14px;">
						<img src="${base}/themes/default/images/warn.png" style="vertical-align: sub;"/>
						<span id="read-msg" style="color:#383838;padding-left:4px;">注意保护好您的账户和密码</span>
					</div>
					<div class="input-group">
						<span class="input-group-addon" id="basic-addon1">
							<img src="${base}/images/admin.png" />
						</span>
						<input type="text" id="userName" class="form-control" size="25" tabindex="1" name="userName" placeholder="登录账号"/>
					</div>

					<div class="input-group">
						<span class="input-group-addon" id="basic-addon1">
							<img src="${base}/images/passw.png"/>
						</span>
						<input type="password" id="password" name="password" class="form-control" size="25" tabindex="2"  placeholder="登录密码" />
					</div>

					<div class="input-group">
						<span class="input-group-addon" id="basic-addon1">
							<img src="${base}/images/safeKEY.png"/>
						</span>
 						<input id="pin" type="password" tabindex="3" class="form-control" placeholder="安全口令" />
					</div>

 					<div class="input-group ">
						<div class="btnLogin" id="btn-login">登&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;录</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<div class="loginFooter">
		<div class="container">
			<div class="lefthill footerImg">
				<img src="${base}/themes/default/images/hill2.png"/>
			</div>
			<div class="shipImg footerImg">
				<img src="${base}/themes/default/images/ship.png"/>
			</div>
			<div class="righthill footerImg">
				<img src="${base}/themes/default/images/hill1.png"/>
			</div>
			<p class="fs12" style="color: #FFFFFF;opacity: 0.8;text-align: center;margin-top: 50px;">
				&copy;技术支持：信大捷安
			</p>
		</div>
	</div>

        <script src="${base}/script/lib/jquery/jquery-1.11.1.min.js"></script>
        <script src="${base}/script/lib/jquery/jquery.cookie.js"></script>

        <script src="${base}/script/lib/card/card.ws-1.0.0.js" type="text/javascript"></script>
        <script src="${base}/script/lib/card/card-1.0.1.js" type="text/javascript"></script>

    <!--<script src="${base}/script/lib/jquery.placeholder.js"></script>-->

	<script src="${base}/script/lib/jquery/app_login.js"></script>
	<script src="${base}/script/lib/jquery/config.js"></script>
	<script>
		var base = "${base}";
		
		var wrong = function(result,isSuccess) {
			if (isSuccess) {
				$("#infoDiv").css({
					"border" : "1px solid #ffe57d",
					"background-color" : "#fff6d2"
				});
				$("#infoDiv img").attr("src", "${base}/themes/default/images/warn.png");
				$("#read-msg").css("color","#383838");
			} else {
				$("#infoDiv").css({
					"border" : "1px solid #e4393c",
					"background-color" : "#ffebeb"
				});
				$("#infoDiv img").attr("src", "${base}/themes/default/images/stop.png");
				$("#read-msg").css("color","red");
			}

			$("#read-msg").html(result);
			
		}
		

		if("${RequestParameters.message!}" != "") {
 			wrong("${RequestParameters.message!}",false);
 		}
		
		function downloadFile(){
			window.location.href =  base + '/downloads/readCard.rar';
		}

		function refrshThis(){
			location.href = base + '/login.do';
		}
		
		//错误描述
		var errorDesc = {
			'0':'未安装安全控件，请<a href="javascript:" onclick="downloadFile()">下载</a>安装',
			'3':'安全控件有新版啦，请<a href="javascript:" onclick="downloadFile()">下载</a>安装',
			'4':'安全控件有新版啦，请<a href="javascript:" onclick="downloadFile()">下载</a>安装',
			'9':'安全控件不支持此版本',
			'-100':'您的USB Key不支持，请使用新版USB Key'
		};
		
		/**
		 * 拔卡监听
		 * @param plugin
		 * @param card
		 */
		function pullCard(plugin, card){
			//监听拔卡
			plugin.onpullcard(card.getCardId(), function(){
				wrong('请插入您的USB Key，然后<a href="javascript:" onclick="refrshThis()">刷新</a>本页面',false);
				$('#btn-login').unbind('click');
			});
		}

		//检测安全卡是否可用
		function checkCard(plugin, callback){
			//callback可有可无
			callback = callback || $.noop;

			if(plugin.error) return;

			//读取安全卡(uk)
			plugin.readUserUSBKeyCard(function(cards){

				//读取安全卡(tf)
				plugin.readUserTFCard(function(cardsTF){
					cards.push(cardsTF); //读取TF卡并且和Ukey组装到一起

					if(!cards.length){//USBKey未插入
						wrong('请插入您的USB Key，然后<a href="javascript:" onclick="refrshThis()">刷新</a>本页面',false);
						return ;
					}
					if(cards.length > 1) {//插入了多张usbkey
						wrong('登录时只能插入一个USB Key',false);
						return;
					}

					var cardId = cards[0].getCardId();

					if(cardId == 'changeSafePin'){
						wrong('您已修改安全口令，必须关闭浏览器的所有窗口，然后重新登录');
						return;
					}
					callback.call(this, cards[0]);
				});
			});
		}

		//初始化安全控件
		var plugin, loginPage = function(){
			Card.ready(function(data){
				if(!data.success) { //卡控件未安装
					wrong(errorDesc[data.code]);
					return;
				}

				if(this.newVer) {//控件版本大于最低版本小于当前版本(有更新,但不强制)
					//非强制升级
					if(!errorMessage) wrong.addClass('wrong-bg').html(errorDesc[4]);
				}

				plugin = this;


				checkCard(this, function(card){
					if(!card) return;

					$("#cardId").val(card.getCardId());

					if(card){
						$('#btn-login').click(btnSubmit);
						pullCard(plugin, card);
					}
					/*card.getPinTryCount(function(ret){
						if (!ret.success) {
							if(ret.isLock){
								wrong('USB Key已锁死',false);
								pullCard(plugin, card);
								return ;
							}

							if(ret.code != -100){
								wrong(errorDesc[ret.code] || ret.message,false);
								pullCard(plugin, card);
								return ;
							}
						}



					})*/
				})
			});
		};
		setTimeout(loginPage, 200);


		// 用户名密码登录按钮事件
		function btnSubmit(){
			var $this = $(this).unbind('click');
			
			var fn = function(){
				checkCard(plugin, function(card){
					if(!card) {$this.click(btnSubmit);return;}
					if(!checkForm()) {$this.click(btnSubmit);return ;}

					card.checkPin($("#pin").val(), function(ret){
						if(!ret.success) {
							if(ret.code > 0){
								wrong('安全口令错误，您还有 ' + ret.code + '次机会' + (ret.code == 1?'，再次输错将锁死USB Key':''),false);
								$this.click(btnSubmit);
								return ;
							}

							if(ret.isLock){
								wrong('USB Key已锁死',false);
								pullCard(plugin, card);
								return;

							} else {
								wrong("安全口令错误",false);
								$this.click(btnSubmit);
								return ;
							}
						}
						$('#cardId').val(card.getCardId());
						$("#frm").submit();
					});

				});
			};
			
			setTimeout(fn, 10);
		}

		// 监听Enter键进行登陆
		$(document.documentElement).keydown(function(event) {
			if (event.keyCode == 13 && !$("#btn-login").prop('disabled')) {
				$("#btn-login").click();
			}
		});

		//校验表单
		function checkForm() {
			if ($("#userName").val() == '') {
				//密码不能为空
				wrong('用户名不能为空',false);
				return ;
			}
			
			if ($("#password").val() == '') {
				//密码不能为空
				wrong('密码不能为空',false);
				return ;
			}
			
//			if (!/^\w{6,16}$/g.test($("#userName").val()) || !/^\w{6,16}$/g.test($("#password").val()) ) {
//				//密码不能为空
//				wrong('安通帐号或密码错误');
//				return ;
//			}

/**注释卡控件
			if ($("#pin").val() == '') {
				//安全卡口令不能为空!
				wrong('安全口令不能为空 ',false);
				return ;
			}
**/			
			return true;
		}

    </script>
     <script type="text/javascript">
    	$(function(){

/**注释卡控件
    		$("#pin").placeholder({
 			   // 将删除原有 placehodler 属性，强制用 JS 实现替代
 			   useNative: true,
 			   // focus 时不清除提示文本， keypress 有效字符时才清空
 			   hideOnFocus: false,
 			   // 附加样式
 			  	style: {
 			     textShadow: 'none'
 			   },
 			   customClass:'my-placeholder'
 			});
**/

//    		$("#userName").placeholder({
//    			   // 将删除原有 placehodler 属性，强制用 JS 实现替代
//    			   useNative: true,
//    			   // focus 时不清除提示文本， keypress 有效字符时才清空
//    			   hideOnFocus: false,
//    			   // 附加样式
//    			  	style: {
//    			     textShadow: 'none'
//    			   },
//    			   customClass:'my-placeholder'
//    		});
//
//    		$("#password").placeholder({
// 			   // 将删除原有 placehodler 属性，强制用 JS 实现替代
// 			   useNative: true,
// 			   // focus 时不清除提示文本， keypress 有效字符时才清空
// 			   hideOnFocus: false,
// 			   // 附加样式
// 			   style: {
// 			     textShadow: 'none'
// 			   }
// 			});
    		
//    		$("#header-logo-link").attr("href", safecenterUrl);
//   		$("#header-oa-link").attr("href", oaLoginUrl);

    		 $(".oa-screen-action a").mouseover(function () {
    		
    			 var btns = $(".oa-screen-action .btn");
    			 $(".oa-pic").hide();
    			 var target = $(this).attr("target");

    			 $("#"+target).show();
    			 btns.each(function( i, n ) {
   					$(n).removeClass("active");
				});
    			 $(this).addClass("active");
    		 });


			//云漂浮的轨迹
			var container = document.querySelector('.scroll-containerFirst');
			setTimeout(function (){
				container.className="scroll-containerFirst scoll";
			}, 20000);

			var containerSecond = document.querySelector('.srcoll-containerSecond');
			setTimeout(function (){
				containerSecond.className="srcoll-containerSecond scoll";
			}, 80000);

			var containerThird = document.querySelector('.srcoll-containerThird');
			setTimeout(function (){
				containerThird.className="srcoll-containerThird scoll";
			}, 100000);
    	});
    </script>
</body>
</html>

